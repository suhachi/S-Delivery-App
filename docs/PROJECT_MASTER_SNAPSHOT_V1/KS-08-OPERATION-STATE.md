# KS 심플배달앱 - 운영 상태 고정 자료

**생성일**: 2025-12-10  
**목적**: 현재 앱의 실제 운영 상태 및 고정 규칙 문서화

---

## 1. 현재 배포된 URL 목록

### 템플릿 프로젝트 (Template)

**프로덕션 (Production)**:
- **Firebase Hosting URL**: `https://simple-delivery-app-9d347.web.app`
- **프로젝트 ID**: `simple-delivery-app-9d347`
- **상태**: 템플릿/데모용 (실제 운영 아님)

**테스트 (Test)**:
- 개발 서버: `http://localhost:3000` (npm run dev)
- 빌드 미리보기: `http://localhost:4173` (npm run preview)

**커스텀 도메인**:
- 현재 미설정

---

### 클라이언트 프로젝트 생성 시

**프로덕션 URL**:
- Firebase Hosting 기본 URL: `https://{project-id}.web.app`
- Firebase Hosting 커스텀 도메인: 설정 가능

**테스트 URL**:
- 개발 서버: `http://localhost:3000`
- Firebase Hosting 미리보기: `https://{project-id}--preview-{hash}.web.app`

---

## 2. 심플앱 고정 규칙 문서

### ✅ 허용된 기능

#### 1. 기본 기능
- ✅ **단일 상점 구조**: 한 앱 = 한 상점 (storeId: 'default')
- ✅ **주소 문자열 기반**: 배달 주소는 문자열로 입력/저장
- ✅ **이메일/비밀번호 인증**: Firebase Authentication 사용
- ✅ **Firestore 데이터베이스**: NoSQL 구조
- ✅ **Firebase Storage**: 이미지 업로드용

#### 2. 주문 관리
- ✅ **주문 상태**: 접수 → 준비중 → 배달중 → 완료 (또는 취소)
- ✅ **주문 조회**: 사용자는 본인 주문만, 관리자는 전체 주문 조회
- ✅ **주문 삭제**: 관리자만 가능 (Hard Delete)

#### 3. 결제
- ✅ **NICEPAY 연동**: 결제 게이트웨이
- ✅ **결제 콜백**: `/payment/nicepay/return` 또는 `/nicepay/return`
- ✅ **결제 검증**: Cloud Functions에서 서버 사이드 검증

#### 4. 관리자 기능
- ✅ **메뉴 관리**: CRUD, 카테고리별 조회
- ✅ **주문 관리**: 상태 변경, 삭제
- ✅ **쿠폰 관리**: 생성, 활성화/비활성화, 사용 처리
- ✅ **리뷰 관리**: 승인/거부, 답글 작성
- ✅ **공지사항 관리**: 생성, 고정, 카테고리별 분류
- ✅ **이벤트 관리**: 배너 이미지, 기간 설정
- ✅ **상점 설정**: 기본 정보, 배달 설정, 브랜딩

#### 5. 사용자 기능
- ✅ **메뉴 탐색**: 카테고리별, 검색
- ✅ **장바구니**: localStorage 기반, 페이지 새로고침 유지
- ✅ **주문 생성**: 결제 완료 후 Firestore에 저장
- ✅ **주문 조회**: 본인 주문 내역 및 상세
- ✅ **리뷰 작성**: 주문 완료 후 리뷰 작성 가능
- ✅ **쿠폰 사용**: 결제 페이지에서 쿠폰 적용

---

### ❌ 금지된 기능 (변경 불가)

#### 1. 배달 관련
- ❌ **배달 반경 기능 없음**: 주소 기반 반경 계산 기능 없음
- ❌ **지도 기능 없음**: Google Maps, Kakao Map 등 지도 API 연동 없음
- ❌ **실시간 위치 추적 없음**: 배달원 위치 추적 기능 없음
- ❌ **배달 시간 예측 없음**: 예상 배달 시간 계산 기능 없음

#### 2. 주소 관련
- ❌ **좌표 기반 주소 없음**: 위도/경도 좌표 저장/사용 없음
- ❌ **주소 검증 없음**: 주소 유효성 검증 로직 없음
- ✅ **주소 문자열만 사용**: 사용자가 입력한 주소 문자열 그대로 저장

#### 3. 멀티 테넌트 관련
- ❌ **다중 상점 지원 없음**: 현재는 단일 상점 구조만 지원
- ❌ **상점 전환 기능 없음**: 한 앱에서 여러 상점 전환 불가
- ✅ **단일 상점 구조 유지**: `stores/default` 고정

#### 4. 클라이언트별 임의 기능 추가
- ❌ **클라이언트별 임의 기능 추가 금지**: 기본 기능 외 임의 기능 추가 불가
- ❌ **커스텀 기능 개발 금지**: 클라이언트 요청에 따른 임의 기능 개발 불가
- ✅ **템플릿 기능만 사용**: 문서화된 기능만 사용

#### 5. 데이터 구조 변경
- ❌ **Firestore 컬렉션 구조 변경 금지**: `stores/{storeId}/subcollection` 구조 유지
- ❌ **보안 규칙 임의 변경 금지**: `firestore.rules` 기본 규칙 유지
- ❌ **인덱스 구조 변경 금지**: `firestore.indexes.json` 기본 인덱스 유지

---

### 🔒 보안 규칙

#### 1. Firestore 보안 규칙
- ✅ **공개 읽기**: `stores`, `menus`, `notices`, `events`, `coupons` (공개)
- ✅ **인증 필요**: `orders`, `reviews` (본인 또는 관리자)
- ✅ **관리자 전용**: 모든 쓰기 작업은 관리자만 가능

#### 2. Storage 보안 규칙
- ✅ **공개 읽기**: 모든 이미지 공개 읽기
- ✅ **인증 필요**: 이미지 업로드는 인증된 사용자만
- ✅ **본인만 쓰기**: 프로필 이미지는 본인만 업로드

#### 3. 환경 변수
- ✅ **Git 제외**: `.env` 파일은 `.gitignore`에 포함
- ✅ **템플릿 키 사용 금지**: 실제 운영 시 템플릿 키 사용 불가
- ✅ **결제 키 보안**: NICEPAY Client ID는 환경 변수로 관리

---

### 📋 데이터 모델 고정 사항

#### 1. 상점 (Store)
- **문서 ID**: `default` (고정)
- **경로**: `stores/default`
- **변경 불가**: 멀티 테넌트 확장 시에만 변경 가능

#### 2. 주문 (Order)
- **상태 값**: `'접수' | '준비중' | '배달중' | '완료' | '취소'` (고정)
- **경로**: `stores/{storeId}/orders`
- **변경 불가**: 상태 값 변경 불가

#### 3. 리뷰 (Review)
- **상태 값**: `'pending' | 'approved' | 'rejected'` (고정)
- **평점 범위**: 1-5 (고정)
- **경로**: `stores/{storeId}/reviews`

#### 4. 쿠폰 (Coupon)
- **할인 타입**: `'fixed' | 'percentage'` (고정)
- **경로**: `stores/{storeId}/coupons`

---

### 🚫 클라이언트별 임의 변경 금지 사항

1. **기능 추가 금지**:
   - 배달 반경 기능 추가 불가
   - 지도 기능 추가 불가
   - 실시간 위치 추적 추가 불가
   - 멀티 상점 기능 추가 불가

2. **데이터 구조 변경 금지**:
   - Firestore 컬렉션 구조 변경 불가
   - 문서 스키마 임의 변경 불가
   - 인덱스 구조 변경 불가

3. **보안 규칙 변경 금지**:
   - Firestore Rules 임의 변경 불가
   - Storage Rules 임의 변경 불가

4. **결제 프로세스 변경 금지**:
   - NICEPAY 외 다른 결제 게이트웨이 추가 불가
   - 결제 콜백 URL 변경 불가

---

### ✅ 클라이언트별 허용된 변경 사항

1. **브랜딩**:
   - 상점 이름, 로고, 배너 이미지
   - 메인 테마 색상 (`primaryColor`)

2. **기본 설정**:
   - 배달비 (`deliveryFee`)
   - 최소 주문 금액 (`minOrderAmount`)
   - 영업시간 (`openingHours`)

3. **콘텐츠**:
   - 메뉴, 공지사항, 이벤트 내용
   - 쿠폰 설정

---

### 📝 복제 시 체크리스트

**변경 필요**:
- [ ] `.firebaserc`: 프로젝트 ID 변경
- [ ] `.env`: Firebase Config 값 변경
- [ ] `scripts/check-deploy.mjs`: `REQUIRED_ACCOUNT` 확인/변경
- [ ] NICEPAY Return URL: 새 도메인 등록
- [ ] Functions 환경 변수: `nicepay.secret_key` 설정

**변경 불가**:
- [ ] Firestore 컬렉션 구조
- [ ] 보안 규칙 기본 로직
- [ ] 주문 상태 값
- [ ] 리뷰 상태 값
- [ ] 쿠폰 할인 타입

---

**완료**: 모든 17개 파일 생성 완료

