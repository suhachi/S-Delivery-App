# 제품 요구사항 정의서 (PRD) – Simple Delivery App

---

## 1. 개요 (Overview)

### 1.1 표지 (Cover)

| 항목 | 내용 |
| :--- | :--- |
| **문서명** | **제품 요구사항 정의서 (Product Requirement Document)** |
| **프로젝트** | Simple Delivery App (Multi-Client Template) |
| **버전** | **v1.0** |
| **작성일** | 2025-12-15 |
| **작성자** | **Anti-Gravity (AI Agent)** |
| **상태** | **확정 (Approved)** |

### 1.2 개정이력 (History)

| 버전 | 일자 | 변경 내용 | 승인자 |
| :---: | :---: | :--- | :---: |
| v1.0 | 2025-12-15 | 최초 원자 단위 요구사항 정의 (User Stories & AC) | KS |

### 1.3 제품 비전 (Product Vision)
> **"누구나 5분 만에 자신의 배달 앱을 가질 수 있게 한다."**
> 단일 매장(Single Store)에 최적화된 초경량, 고성능 배달 앱 템플릿으로, 복잡한 중개 플랫폼 없이 점주와 고객을 직접 연결한다.

---

## 2. 사용자 페르소나 (User Personas)

### 2.1 Customer (고객) - "배고픈 현수"
*   **특징**: 앱 설치가 귀찮지만 단골 가게의 음식을 편하게 시키고 싶음.
*   **Needs**: 복잡한 회원가입 없이 빠르게 주문하고 싶음. 내 주문이 언제 오는지 궁금함.
*   **Pain Points**: "배달비가 너무 비싸요", "주문이 된 건지 모르겠어요".

### 2.2 Store Owner (점주) - "바쁜 김사장"
*   **특징**: 요리하느라 스마트폰을 계속 들여다볼 수 없음. PC/태블릿으로 주문을 관리함.
*   **Needs**: 주문이 들어오면 **소리**로 바로 알고 싶음. 배달 대행을 부르기 위해 주소가 정확해야 함.
*   **Pain Points**: "앱 설정이나 메뉴 수정이 너무 어려워요".

---

## 3. 기능 요구사항 (Functional Requirements) - Atomic Level

각 요구사항은 **고유 ID**를 가지며, **Acceptance Criteria (AC, 인수 조건)**로 완료 여부를 판단한다.

### 3.1 회원 및 인증 (AUTH)

#### FR-AUTH-001: 고객 회원가입/로그인
*   **User Story**: 고객은 주문 내역을 관리하기 위해 이메일로 가입/로그인할 수 있어야 한다.
*   **Acceptance Criteria (AC)**:
    1.  [필수] 이메일 형식이 아닐 경우 "올바른 이메일 형식이 아닙니다" 에러를 표시한다.
    2.  [필수] 비밀번호는 6자리 이상이어야 한다.
    3.  [필수] 가입 성공 시 즉시 로그인 상태로 전환되고 메인 화면으로 이동한다.
    4.  [예외] 이미 존재하는 이메일일 경우 "이미 가입된 계정입니다"를 표시한다.

#### FR-AUTH-002: 보호된 라우트 접근 제어
*   **User Story**: 로그인하지 않은 사용자는 장바구니/주문 내역 페이지에 접근할 수 없다.
*   **AC**:
    1.  [보안] `/cart`, `/orders` 접근 시 로그인 토큰이 없으면 `/login`으로 리다이렉트한다.
    2.  [보안] `/admin` 접근 시 `role: 'admin'`이 아니면 메인으로 튕겨낸다.

---

### 3.2 상품(메뉴) 탐색 (MENU)

#### FR-MENU-001: 카테고리별 메뉴 목록 조회
*   **User Story**: 고객은 원하는 음식을 찾기 위해 카테고리 탭을 눌러 메뉴를 필터링할 수 있다.
*   **AC**:
    1.  [UI] 상단 탭에는 DB에 존재하는 카테고리만 노출된다.
    2.  [동작] 탭 클릭 시 화면 깜빡임 없이 해당 리스트만 필터링되어야 한다(CSR).
    3.  [데이터] `isSoldOut: true`인 메뉴는 이미지 위에 '품절' 뱃지가 붙고 클릭이 불가능(또는 안내)해야 한다.

#### FR-MENU-002: 장바구니 담기
*   **User Story**: 고객은 메뉴 상세 팝업에서 수량을 결정하고 장바구니에 담을 수 있다.
*   **AC**:
    1.  [검증] 수량은 1 이상이어야 한다.
    2.  [UX] "담기" 버튼 클릭 시 "장바구니에 담았습니다" 토스트(Toast)가 뜬다.
    3.  [데이터] 이미 장바구니에 있는 메뉴와 옵션이 동일하면 항목 추가 대신 수량만 증가시킨다.

---

### 3.3 주문 및 결제 (ORDER)

#### FR-ORDER-001: 주문 생성 (Checkout)
*   **User Story**: 고객은 배송지와 결제 수단을 입력하고 최종 주문을 확정한다.
*   **AC**:
    1.  [필수] 배송지 주소와 상세 주소(동/호수)가 비어있으면 주문 불가.
    2.  [필수] 연락처가 비어있으면 주문 불가.
    3.  [검증] 최소 주문 금액(`store.minOrderAmount`) 미만일 경우 "00원 더 담으셔야 해요" 경고.
    4.  [데이터] 주문 생성 시 `createdAt`은 서버 시간(ServerTimestamp)으로 기록된다.
    5.  [상태] 초기 생성된 주문의 상태는 `pending`(접수대기)이다.

#### FR-ORDER-002: 실시간 주문 상태 확인
*   **User Story**: 고객은 내 주문이 접수되었는지, 배달 중인지 실시간으로 확인하고 싶다.
*   **AC**:
    1.  [Tech] Firestore `onSnapshot`을 사용하여 관리자가 상태를 변경하면 고객 화면도 **새로고침 없이** 즉시 변경되어야 한다.
    2.  [UI] 상태별 Progress Bar 또는 텍스트 색상이 변경된다 (대기: 회색 -> 접수: 파랑 -> 배달: 초록).

---

### 3.4 관리자 기능 (ADMIN)

#### FR-ADMIN-001: 실시간 주문 접수 알림
*   **User Story**: 사장님은 다른 일을 하다가도 새 주문이 들어오면 소리로 알 수 있어야 한다.
*   **AC**:
    1.  [UX] `pending` 상태의 새 문서가 추가되는 즉시 `notification.mp3`가 재생된다.
    2.  [UX] 오디오 권한 정책(Autoplay Policy)에 의해 소리가 막힐 경우, "알림 켜기" 버튼을 눈에 띄게 노출한다.

#### FR-ADMIN-002: 주문 상태 워크플로우 제어
*   **User Story**: 사장님은 주문을 접수하거나 취소할 수 있다.
*   **AC**:
    1.  [Flow] 대기 -> (접수/거절) -> 준비 -> 배달 -> 완료 순서로만 변경 가능하다.
    2.  [데이터] '거절' 시에는 반드시 `cancelReason`을 입력받아야 한다.

---

## 4. 데이터 요구사항 (Data Requirements)

### 4.1 데이터 무결성
*   **Order ID**: 난수+날짜 조합 등 **고유성**이 보장되어야 한다.
*   **Price**: 모든 금액 계산(메뉴단가 x 수량 + 배달팁 - 쿠폰)은 프론트엔드뿐만 아니라 **검증 로직(Security Rules or Functions)**에서도 유효해야 한다. (현재 버전은 Client 신뢰 모델이나 추후 보강)

### 4.2 데이터 보존
*   **Soft Delete**: 관리자가 메뉴를 삭제해도, 기존 주문 내역에는 메뉴 정보(스냅샷)가 남아있어야 한다.
    *   *전략: 주문 생성 시점의 메뉴 이름/가격을 Order 문서에 복사(Duplication)하여 저장한다.*

---

## 5. 비기능 요구사항 (Non-Functional Requirements)

### 5.1 성능 (Performance)
*   **초기 로딩**: 첫 화면(LCP)은 모바일 4G 환경 기준 **1.5초 이내**에 떠야 한다 (Vite 빌드 최적화).
*   **반응 속도**: 주문 접수/상태 변경 반응은 **500ms 이내**에 UI에 반영되어야 한다 (Optimistic UI 권장).

### 5.2 보안 (Security)
*   **규칙(Rules)**: 고객은 자신의 주문만 읽을 수 있다 (`request.auth.uid == data.userId`).
*   **관리자**: 관리자 권한은 `admins` 컬렉션 또는 하드코딩된 이메일 목록에 의해서만 부여된다.

### 5.3 확장성 (Scalability)
*   **멀티 테넌트**: 본 소스 코드는 **설정 파일 교체만으로** 다른 상점 앱으로 복제될 수 있어야 한다 (`.firebaserc`, `.env` 의존성).

---

## 6. 용어 사전 (Glossary)

*   **Pending**: 주문이 서버에 들어왔으나 아직 사장님이 보지 못한 상태.
*   **Preparing**: 사장님이 접수하고 조리를 시작한 상태.
*   **Delivery**: 라이더(또는 사장님)가 음식을 들고 출발한 상태.
*   **Completed**: 고객에게 전달 완료된 상태.
